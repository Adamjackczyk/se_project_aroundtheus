!function(){"use strict";var e=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}updateProfile(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}addCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://adamjackczyk.github.io/se_project_aroundtheus/",headers:{authorization:"ffb58f50-1cd0-425f-a937-3b1dae87c6d4","Content-Type":"application/json"}});class t{constructor(e,t,s){this._name=e.name,this._link=e.link,this._cardSelector=t,this._handleImageClick=s}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._cardImageElement.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)})),this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._toggleLikeButton()})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._deleteCard()}))}_toggleLikeButton(){this._cardElement.querySelector(".card__like-button").classList.toggle("card__like-button_active")}_deleteCard(){this._cardElement.remove(),this._cardElement=null}generateCard(){return this._cardElement=this._getTemplate(),this._cardImageElement=this._cardElement.querySelector(".card__image"),this._cardElement.querySelector(".card__title").textContent=this._name,this._cardImageElement.src=this._link,this._cardImageElement.alt=this._name,this._setEventListeners(),this._cardElement}}class s{constructor(e,t){this._settings=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._submitButton=this._formElement.querySelector(this._settings.submitButtonSelector),this._inactiveButtonClass=this._settings.inactiveButtonClass}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}toggleButtonState(){this._hasInvalidInput()?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._settings.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._setEventListeners(),this.toggleButtonState()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this.toggleButtonState()}}class r{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("modal_opened")||e.target.classList.contains("modal__close"))&&this.close()}))}}class n extends r{constructor(e,t,s){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".modal__form"),this._formValidator=s}_getInputValues(){return this._formValues={},this._form.querySelectorAll(".modal__input").forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this._form.reset(),this._formValidator.toggleButtonState()}))}open(){super.open(),this._formValidator.resetValidation()}}const i={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function a(e,t){m.open({name:e,link:t})}function o(s){const r=new t(s,"#card-template",a,{handleDeleteCard:t=>{e.deleteCard(t).then((()=>{r.removeCard()})).catch((e=>{console.error(e)}))},handleLikeCard:t=>{r.isLiked()?e.dislikeCard(t).then((e=>{r.updateLikes(e.likes)})).catch((e=>{console.error(e)})):e.likeCard(t).then((e=>{r.updateLikes(e.likes)})).catch((e=>{console.error(e)}))}});return r.generateCard()}const l=new class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{const t=o(e);l.addItem(t)}},".cards__list"),c={};document.querySelectorAll(i.formSelector).forEach((e=>{const t=new s(i,e);t.enableValidation(),c[e.getAttribute("id")]=t}));const d=new class{constructor(e){let{nameSelector:t,jobSelector:s}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo(e){let{name:t,job:s}=e;this._nameElement.textContent=t,this._jobElement.textContent=s}}({nameSelector:"#profile-title",jobSelector:"#profile-desc"}),h=new n("#profile-edit-modal",(t=>{e.updateProfile({name:t.title,about:t.description}).then((e=>{d.setUserInfo({name:e.name,job:e.about}),h.close()})).catch((e=>{console.error(e)}))}),c["edit-profile-form"]),_=new n("#add-card-modal",(t=>{const s={name:t.title,link:t.link};e.addCard(s).then((e=>{const t=o(e);l.addItem(t),_.close()})).catch((e=>{console.error(e)}))}),c["add-card-form"]),u=new n("#avatar-edit-modal",(t=>{e.updateAvatar(t.avatar).then((e=>{d.setAvatar(e.avatar),u.close()})).catch((e=>{console.error(e)}))}),c["edit-avatar-form"]);h.setEventListeners(),_.setEventListeners(),u.setEventListeners();const m=new class extends r{constructor(e){super(e),this._image=this._popup.querySelector(".modal__image"),this._caption=this._popup.querySelector(".modal__image-label")}open(e){let{name:t,link:s}=e;this._image.src=s,this._image.alt=t,this._caption.textContent=t,super.open()}}("#modal-image-display");m.setEventListeners(),document.getElementById("profile-edit-button").addEventListener("click",(()=>{const e=d.getUserInfo();document.getElementById("profile-title-input").value=e.name,document.getElementById("profile-description-input").value=e.job,h.open()})),document.querySelector(".profile__add-button").addEventListener("click",(()=>{_.open()})),document.querySelector(".profile__pic").addEventListener("click",(()=>{u.open()})),document.addEventListener("DOMContentLoaded",(()=>{e.getUserInfo().then((e=>{d.setUserInfo({name:e.name,job:e.about,avatar:e.avatar})})).catch((e=>{console.error(e)})),e.getInitialCards().then((e=>{e.forEach((e=>{const t=o(e);l.addItem(t)}))})).catch((e=>{console.error(e)}))}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dkQsU0FBU00saUJBQWlCLG9CQUFvQixLQUU1QzZFLEVBQUFBLGNBRUc5RyxNQUFNNEosSUFDTG5CLEVBQVNNLFlBQVksQ0FDbkJ2SSxLQUFNb0osRUFBYXBKLEtBQ25Cc0ksSUFBS2MsRUFBYW5KLE1BQ2xCRSxPQUFRaUosRUFBYWpKLFFBQ3JCLElBRUhxRyxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBSXRCSCxFQUFBQSxrQkFFRzlHLE1BQU02SixJQUNMQSxFQUFNbkYsU0FBU2lDLElBQ2IsTUFBTTJCLEVBQWM1QixFQUFXQyxHQUMvQmMsRUFBUVUsUUFBUUcsRUFBWSxHQUM1QixJQUVIdEIsT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxHQUNsQixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICAgIGlmIChyZXMub2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlUHJvZmlsZShkYXRhKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgIGFib3V0OiBkYXRhLmFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogYXZhdGFyLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBhZGRDYXJkKGRhdGEpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcclxuICAgICAgICBsaW5rOiBkYXRhLmxpbmssXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2FkYW1qYWNrY3p5ay5naXRodWIuaW8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy9cIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImZmYjU4ZjUwLTFjZDAtNDI1Zi1hOTM3LTNiMWRhZTg3YzZkNFwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhcGk7XHJcbiIsIi8vIGNvbXBvbmVudHMvQ2FyZC5qc1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoZGF0YSwgY2FyZFNlbGVjdG9yLCBoYW5kbGVJbWFnZUNsaWNrKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xyXG4gIH1cclxuXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxyXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICAgIHJldHVybiBjYXJkRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUxpa2VCdXR0b24oKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9kZWxldGVDYXJkKCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZUxpa2VCdXR0b24oKSB7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxyXG4gICAgICAuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICB9XHJcblxyXG4gIF9kZWxldGVDYXJkKCkge1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbGVtZW50ID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlRWxlbWVudC5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlRWxlbWVudC5hbHQgPSB0aGlzLl9uYW1lO1xyXG5cclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50O1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxyXG4gICAgKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICApO1xyXG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgfVxyXG5cclxuICBfaGFzSW52YWxpZElucHV0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xyXG4gIH1cclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KTtcclxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9XHJcblxyXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRXNjQ2xvc2UoZXZlbnQpIHtcclxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldmVudCkgPT4ge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSB8fFxyXG4gICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fY2xvc2VcIilcclxuICAgICAgKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQsIGZvcm1WYWxpZGF0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuICAgIHRoaXMuX2Zvcm1WYWxpZGF0b3IgPSBmb3JtVmFsaWRhdG9yO1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgdGhpcy5fZm9ybVZhbHVlcyA9IHt9O1xyXG4gICAgdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKS5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9mb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLl9mb3JtVmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XHJcbiAgICAgIHRoaXMuX2Zvcm1WYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHN1cGVyLm9wZW4oKTtcclxuICAgIHRoaXMuX2Zvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXHJcbiAge1xyXG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC95b3NlbWl0ZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGFrZSBMb3Vpc2VcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWtlLWxvdWlzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhdGVtYXIuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3Zhbm9pc2UuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFnby5qcGdcIixcclxuICB9LFxyXG5dO1xyXG5cclxuZXhwb3J0IGNvbnN0IGZvcm1WYWxpZGF0aW9uT3B0aW9ucyA9IHtcclxuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXHJcbn07XHJcbiIsImltcG9ydCBhcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IHsgZm9ybVZhbGlkYXRpb25PcHRpb25zIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayhuYW1lLCBsaW5rKSB7XHJcbiAgcG9wdXBXaXRoSW1hZ2Uub3Blbih7IG5hbWUsIGxpbmsgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoY2FyZERhdGEpIHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoY2FyZERhdGEsIFwiI2NhcmQtdGVtcGxhdGVcIiwgaGFuZGxlSW1hZ2VDbGljaywge1xyXG4gICAgaGFuZGxlRGVsZXRlQ2FyZDogKGNhcmRJZCkgPT4ge1xyXG4gICAgICBhcGlcclxuICAgICAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgY2FyZC5yZW1vdmVDYXJkKCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGhhbmRsZUxpa2VDYXJkOiAoY2FyZElkKSA9PiB7XHJcbiAgICAgIGlmIChjYXJkLmlzTGlrZWQoKSkge1xyXG4gICAgICAgIGFwaVxyXG4gICAgICAgICAgLmRpc2xpa2VDYXJkKGNhcmRJZClcclxuICAgICAgICAgIC50aGVuKChuZXdDYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBjYXJkLnVwZGF0ZUxpa2VzKG5ld0NhcmREYXRhLmxpa2VzKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC5saWtlQ2FyZChjYXJkSWQpXHJcbiAgICAgICAgICAudGhlbigobmV3Q2FyZERhdGEpID0+IHtcclxuICAgICAgICAgICAgY2FyZC51cGRhdGVMaWtlcyhuZXdDYXJkRGF0YS5saWtlcyk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgfSk7XHJcbiAgcmV0dXJuIGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbn1cclxuXHJcbmNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihcclxuICB7XHJcbiAgICBpdGVtczogW10sXHJcbiAgICByZW5kZXJlcjogKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XHJcbiAgICAgIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICB9LFxyXG4gIH0sXHJcbiAgXCIuY2FyZHNfX2xpc3RcIlxyXG4pO1xyXG5cclxuY29uc3QgZm9ybVZhbGlkYXRvcnMgPSB7fTtcclxuZG9jdW1lbnRcclxuICAucXVlcnlTZWxlY3RvckFsbChmb3JtVmFsaWRhdGlvbk9wdGlvbnMuZm9ybVNlbGVjdG9yKVxyXG4gIC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgZm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1WYWxpZGF0aW9uT3B0aW9ucywgZm9ybUVsZW1lbnQpO1xyXG4gICAgZm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiAgICBmb3JtVmFsaWRhdG9yc1tmb3JtRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJpZFwiKV0gPSBmb3JtVmFsaWRhdG9yO1xyXG4gIH0pO1xyXG5cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxlY3RvcjogXCIjcHJvZmlsZS10aXRsZVwiLFxyXG4gIGpvYlNlbGVjdG9yOiBcIiNwcm9maWxlLWRlc2NcIixcclxufSk7XHJcblxyXG5jb25zdCBwcm9maWxlRWRpdFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXHJcbiAgKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBhcGlcclxuICAgICAgLnVwZGF0ZVByb2ZpbGUoe1xyXG4gICAgICAgIG5hbWU6IGlucHV0VmFsdWVzLnRpdGxlLFxyXG4gICAgICAgIGFib3V0OiBpbnB1dFZhbHVlcy5kZXNjcmlwdGlvbixcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XHJcbiAgICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXHJcbiAgICAgICAgICBqb2I6IGRhdGEuYWJvdXQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcHJvZmlsZUVkaXRQb3B1cC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfSxcclxuICBmb3JtVmFsaWRhdG9yc1tcImVkaXQtcHJvZmlsZS1mb3JtXCJdXHJcbik7XHJcblxyXG5jb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNhZGQtY2FyZC1tb2RhbFwiLFxyXG4gIChpbnB1dFZhbHVlcykgPT4ge1xyXG4gICAgY29uc3QgbmV3Q2FyZERhdGEgPSB7XHJcbiAgICAgIG5hbWU6IGlucHV0VmFsdWVzLnRpdGxlLFxyXG4gICAgICBsaW5rOiBpbnB1dFZhbHVlcy5saW5rLFxyXG4gICAgfTtcclxuICAgIGFwaVxyXG4gICAgICAuYWRkQ2FyZChuZXdDYXJkRGF0YSlcclxuICAgICAgLnRoZW4oKGNhcmQpID0+IHtcclxuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZCk7XHJcbiAgICAgICAgc2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxuICAgICAgICBhZGRDYXJkUG9wdXAuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIH0pO1xyXG4gIH0sXHJcbiAgZm9ybVZhbGlkYXRvcnNbXCJhZGQtY2FyZC1mb3JtXCJdXHJcbik7XHJcblxyXG5jb25zdCBhdmF0YXJFZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNhdmF0YXItZWRpdC1tb2RhbFwiLFxyXG4gIChpbnB1dFZhbHVlcykgPT4ge1xyXG4gICAgYXBpXHJcbiAgICAgIC51cGRhdGVBdmF0YXIoaW5wdXRWYWx1ZXMuYXZhdGFyKVxyXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIHVzZXJJbmZvLnNldEF2YXRhcihkYXRhLmF2YXRhcik7XHJcbiAgICAgICAgYXZhdGFyRWRpdFBvcHVwLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICB9KTtcclxuICB9LFxyXG4gIGZvcm1WYWxpZGF0b3JzW1wiZWRpdC1hdmF0YXItZm9ybVwiXVxyXG4pO1xyXG5cclxucHJvZmlsZUVkaXRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5hZGRDYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYXZhdGFyRWRpdFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBwb3B1cFdpdGhJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNtb2RhbC1pbWFnZS1kaXNwbGF5XCIpO1xyXG5wb3B1cFdpdGhJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9maWxlLWVkaXQtYnV0dG9uXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgdXNlckRhdGEgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZS10aXRsZS1pbnB1dFwiKS52YWx1ZSA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCIpLnZhbHVlID0gdXNlckRhdGEuam9iO1xyXG4gIHByb2ZpbGVFZGl0UG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGFkZENhcmRQb3B1cC5vcGVuKCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19waWNcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhdmF0YXJFZGl0UG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcclxuICAvLyBGZXRjaCB1c2VyIGluZm9ybWF0aW9uIGFuZCByZW5kZXIgaXRcclxuICBhcGlcclxuICAgIC5nZXRVc2VySW5mbygpXHJcbiAgICAudGhlbigodXNlckluZm9EYXRhKSA9PiB7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcclxuICAgICAgICBuYW1lOiB1c2VySW5mb0RhdGEubmFtZSxcclxuICAgICAgICBqb2I6IHVzZXJJbmZvRGF0YS5hYm91dCxcclxuICAgICAgICBhdmF0YXI6IHVzZXJJbmZvRGF0YS5hdmF0YXIsXHJcbiAgICAgIH0pO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgLy8gSGFuZGxlIGVycm9ycyBhcHByb3ByaWF0ZWx5XHJcbiAgICB9KTtcclxuXHJcbiAgLy8gRmV0Y2ggaW5pdGlhbCBjYXJkcyBhbmQgcmVuZGVyIHRoZW1cclxuICBhcGlcclxuICAgIC5nZXRJbml0aWFsQ2FyZHMoKVxyXG4gICAgLnRoZW4oKGNhcmRzKSA9PiB7XHJcbiAgICAgIGNhcmRzLmZvckVhY2goKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGNhcmREYXRhKTtcclxuICAgICAgICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xyXG4gICAgICB9KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7IC8vIEhhbmRsZSBlcnJvcnMgYXBwcm9wcmlhdGVseVxyXG4gICAgfSk7XHJcbn0pO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4gdGhpcy5fcmVuZGVyZXIoaXRlbSkpO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciB9KSB7XHJcbiAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2pvYkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGpvYlNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgIGpvYjogdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XHJcbiAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ID0gam9iO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX2NhcHRpb24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1sYWJlbFwiKTtcclxuICB9XHJcblxyXG4gIG9wZW4oeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHRoaXMuX2ltYWdlLnNyYyA9IGxpbms7XHJcbiAgICB0aGlzLl9pbWFnZS5hbHQgPSBuYW1lO1xyXG4gICAgdGhpcy5fY2FwdGlvbi50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJiYXNlVXJsIiwiX2hlYWRlcnMiLCJoZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJnZXRJbml0aWFsQ2FyZHMiLCJ1cGRhdGVQcm9maWxlIiwiZGF0YSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibmFtZSIsImFib3V0IiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyIiwiYWRkQ2FyZCIsImxpbmsiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJkaXNsaWtlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJDYXJkIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlSW1hZ2VDbGljayIsIl9uYW1lIiwiX2xpbmsiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX2NhcmRJbWFnZUVsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiX2NhcmRFbGVtZW50IiwiX3RvZ2dsZUxpa2VCdXR0b24iLCJfZGVsZXRlQ2FyZCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInJlbW92ZSIsImdlbmVyYXRlQ2FyZCIsInRleHRDb250ZW50Iiwic3JjIiwiYWx0IiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJfc2V0dGluZ3MiLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaGFzSW52YWxpZElucHV0Iiwic29tZSIsImlucHV0RWxlbWVudCIsInZhbGlkaXR5IiwidmFsaWQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImFkZCIsImRpc2FibGVkIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl9oaWRlSW5wdXRFcnJvciIsIl9zaG93SW5wdXRFcnJvciIsImVycm9yRWxlbWVudCIsImlkIiwiaW5wdXRFcnJvckNsYXNzIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvckNsYXNzIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJyZXNldFZhbGlkYXRpb24iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0IiwiZm9ybVZhbGlkYXRvciIsInN1cGVyIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfZm9ybSIsIl9mb3JtVmFsaWRhdG9yIiwiX2dldElucHV0VmFsdWVzIiwiX2Zvcm1WYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwicHJldmVudERlZmF1bHQiLCJyZXNldCIsImZvcm1WYWxpZGF0aW9uT3B0aW9ucyIsImZvcm1TZWxlY3RvciIsInBvcHVwV2l0aEltYWdlIiwiY3JlYXRlQ2FyZCIsImNhcmREYXRhIiwiY2FyZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJhcGkiLCJyZW1vdmVDYXJkIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJoYW5kbGVMaWtlQ2FyZCIsImlzTGlrZWQiLCJuZXdDYXJkRGF0YSIsInVwZGF0ZUxpa2VzIiwibGlrZXMiLCJzZWN0aW9uIiwiX3JlZiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJjYXJkRWxlbWVudCIsImZvcm1WYWxpZGF0b3JzIiwiZ2V0QXR0cmlidXRlIiwidXNlckluZm8iLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsIl9uYW1lRWxlbWVudCIsIl9qb2JFbGVtZW50Iiwiam9iIiwic2V0VXNlckluZm8iLCJfcmVmMiIsInByb2ZpbGVFZGl0UG9wdXAiLCJpbnB1dFZhbHVlcyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJhZGRDYXJkUG9wdXAiLCJhdmF0YXJFZGl0UG9wdXAiLCJzZXRBdmF0YXIiLCJfaW1hZ2UiLCJfY2FwdGlvbiIsImdldEVsZW1lbnRCeUlkIiwidXNlckRhdGEiLCJ1c2VySW5mb0RhdGEiLCJjYXJkcyJdLCJzb3VyY2VSb290IjoiIn0=