!function(){"use strict";var e=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}updateProfile(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}addCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-25",headers:{authorization:"c56e30dc-2883-4270-a59e-b2f7bae969c6","Content-Type":"application/json"}});class t{constructor(e,t,s){this._name=e.name,this._link=e.link,this._cardSelector=t,this._handleImageClick=s}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._cardImageElement.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)})),this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._toggleLikeButton()})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._deleteCard()}))}_toggleLikeButton(){this._cardElement.querySelector(".card__like-button").classList.toggle("card__like-button_active")}_deleteCard(){this._cardElement.remove(),this._cardElement=null}generateCard(){return this._cardElement=this._getTemplate(),this._cardImageElement=this._cardElement.querySelector(".card__image"),this._cardElement.querySelector(".card__title").textContent=this._name,this._cardImageElement.src=this._link,this._cardImageElement.alt=this._name,this._setEventListeners(),this._cardElement}}class s{constructor(e,t){this._settings=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._submitButton=this._formElement.querySelector(this._settings.submitButtonSelector),this._inactiveButtonClass=this._settings.inactiveButtonClass}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}toggleButtonState(){this._hasInvalidInput()?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._settings.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._setEventListeners(),this.toggleButtonState()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this.toggleButtonState()}}class r{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("modal_opened")||e.target.classList.contains("modal__close"))&&this.close()}))}}class n extends r{constructor(e,t,s){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".modal__form"),this._formValidator=s}_getInputValues(){return this._formValues={},this._form.querySelectorAll(".modal__input").forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this._form.reset(),this._formValidator.toggleButtonState()}))}open(){super.open(),this._formValidator.resetValidation()}}const i={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function o(e,t){u.open({name:e,link:t})}function a(s){const r=new t(s,"#card-template",o,{handleDeleteCard:t=>{e.deleteCard(t).then((()=>{r.removeCard()})).catch((e=>{console.error(e)}))},handleLikeCard:t=>{r.isLiked()?e.dislikeCard(t).then((e=>{r.updateLikes(e.likes)})).catch((e=>{console.error(e)})):e.likeCard(t).then((e=>{r.updateLikes(e.likes)})).catch((e=>{console.error(e)}))}});return r.generateCard()}const l=new class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{const t=a(e);l.addItem(t)}},".cards__list"),c={};document.querySelectorAll(i.formSelector).forEach((e=>{const t=new s(i,e);t.enableValidation(),c[e.getAttribute("id")]=t}));const d=new class{constructor(e){let{nameSelector:t,jobSelector:s}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo(e){let{name:t,job:s}=e;this._nameElement.textContent=t,this._jobElement.textContent=s}}({nameSelector:"#profile-title",jobSelector:"#profile-desc"}),h=new n("#profile-edit-modal",(t=>{e.updateProfile({name:t.title,about:t.description}).then((e=>{d.setUserInfo({name:e.name,job:e.about}),h.close()})).catch((e=>{console.error(e)}))}),c["edit-profile-form"]),_=new n("#add-card-modal",(t=>{const s={name:t.title,link:t.link};e.addCard(s).then((e=>{const t=a(e);l.addItem(t),_.close()})).catch((e=>{console.error(e)}))}),c["add-card-form"]),m=new n("#avatar-edit-modal",(t=>{e.updateAvatar(t.avatar).then((e=>{d.setAvatar(e.avatar),m.close()})).catch((e=>{console.error(e)}))}),c["edit-avatar-form"]);h.setEventListeners(),_.setEventListeners(),m.setEventListeners();const u=new class extends r{constructor(e){super(e),this._image=this._popup.querySelector(".modal__image"),this._caption=this._popup.querySelector(".modal__image-label")}open(e){let{name:t,link:s}=e;this._image.src=s,this._image.alt=t,this._caption.textContent=t,super.open()}}("#modal-image-display");u.setEventListeners(),document.getElementById("profile-edit-button").addEventListener("click",(()=>{const e=d.getUserInfo();document.getElementById("profile-title-input").value=e.name,document.getElementById("profile-description-input").value=e.job,h.open()})),document.querySelector(".profile__add-button").addEventListener("click",(()=>{_.open()})),document.querySelector(".profile__avatar").addEventListener("click",(()=>{m.open()})),document.addEventListener("DOMContentLoaded",(()=>{e.getUserInfo().then((e=>{d.setUserInfo({name:e.name,job:e.about,avatar:e.avatar})})).catch((e=>{console.error(e)})),e.getInitialCards().then((e=>{e.forEach((e=>{const t=a(e);l.addItem(t)}))})).catch((e=>{console.error(e)}))}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dkQsU0FBU00saUJBQWlCLG9CQUFvQixLQUU1QzZFLEVBQUFBLGNBRUc5RyxNQUFNNEosSUFDTG5CLEVBQVNNLFlBQVksQ0FDbkJ2SSxLQUFNb0osRUFBYXBKLEtBQ25Cc0ksSUFBS2MsRUFBYW5KLE1BQ2xCRSxPQUFRaUosRUFBYWpKLFFBQ3JCLElBRUhxRyxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBSXRCSCxFQUFBQSxrQkFFRzlHLE1BQU02SixJQUNMQSxFQUFNbkYsU0FBU2lDLElBQ2IsTUFBTTJCLEVBQWM1QixFQUFXQyxHQUMvQmMsRUFBUVUsUUFBUUcsRUFBWSxHQUM1QixJQUVIdEIsT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxHQUNsQixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICAgIGlmIChyZXMub2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlUHJvZmlsZShkYXRhKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgIGFib3V0OiBkYXRhLmFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogYXZhdGFyLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBhZGRDYXJkKGRhdGEpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcclxuICAgICAgICBsaW5rOiBkYXRhLmxpbmssXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL21lc3RvLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTI1XCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCJjNTZlMzBkYy0yODgzLTQyNzAtYTU5ZS1iMmY3YmFlOTY5YzZcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXBpO1xyXG4iLCIvLyBjb21wb25lbnRzL0NhcmQuanNcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIGNvbnN0cnVjdG9yKGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlSW1hZ2VDbGljaykge1xyXG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XHJcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcclxuICB9XHJcblxyXG4gIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxyXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcclxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuXHJcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sodGhpcy5fbmFtZSwgdGhpcy5fbGluayk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl90b2dnbGVMaWtlQnV0dG9uKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIilcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fZGVsZXRlQ2FyZCgpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVMaWtlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcclxuICAgICAgLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgfVxyXG5cclxuICBfZGVsZXRlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlRWxlbWVudCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsZW1lbnQuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsZW1lbnQuYWx0ID0gdGhpcy5fbmFtZTtcclxuXHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICB0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxyXG4gICAgKTtcclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSB0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xyXG4gIH1cclxuXHJcbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9pbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKCkge1xyXG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCgpKSB7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgfVxyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcclxuICB9XHJcblxyXG4gIG9wZW4oKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlKGV2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikgfHxcclxuICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlXCIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0LCBmb3JtVmFsaWRhdG9yKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbiAgICB0aGlzLl9mb3JtVmFsaWRhdG9yID0gZm9ybVZhbGlkYXRvcjtcclxuICB9XHJcblxyXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgIHRoaXMuX2Zvcm1WYWx1ZXMgPSB7fTtcclxuICAgIHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIikuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgdGhpcy5fZm9ybVZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5fZm9ybVZhbHVlcztcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgICAgdGhpcy5fZm9ybS5yZXNldCgpO1xyXG4gICAgICB0aGlzLl9mb3JtVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9wZW4oKSB7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgICB0aGlzLl9mb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QveW9zZW1pdGUuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFrZS1sb3Vpc2UuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkJhbGQgTW91bnRhaW5zXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvYmFsZC1tb3VudGFpbnMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYXRlbWFyLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC92YW5vaXNlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWdvIGRpIEJyYWllc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhZ28uanBnXCIsXHJcbiAgfSxcclxuXTtcclxuXHJcbmV4cG9ydCBjb25zdCBmb3JtVmFsaWRhdGlvbk9wdGlvbnMgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxyXG59O1xyXG4iLCJpbXBvcnQgYXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCB7IGZvcm1WYWxpZGF0aW9uT3B0aW9ucyB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2sobmFtZSwgbGluaykge1xyXG4gIHBvcHVwV2l0aEltYWdlLm9wZW4oeyBuYW1lLCBsaW5rIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGNhcmREYXRhKSB7XHJcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGNhcmREYXRhLCBcIiNjYXJkLXRlbXBsYXRlXCIsIGhhbmRsZUltYWdlQ2xpY2ssIHtcclxuICAgIGhhbmRsZURlbGV0ZUNhcmQ6IChjYXJkSWQpID0+IHtcclxuICAgICAgYXBpXHJcbiAgICAgICAgLmRlbGV0ZUNhcmQoY2FyZElkKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGNhcmQucmVtb3ZlQ2FyZCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBoYW5kbGVMaWtlQ2FyZDogKGNhcmRJZCkgPT4ge1xyXG4gICAgICBpZiAoY2FyZC5pc0xpa2VkKCkpIHtcclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC5kaXNsaWtlQ2FyZChjYXJkSWQpXHJcbiAgICAgICAgICAudGhlbigobmV3Q2FyZERhdGEpID0+IHtcclxuICAgICAgICAgICAgY2FyZC51cGRhdGVMaWtlcyhuZXdDYXJkRGF0YS5saWtlcyk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAubGlrZUNhcmQoY2FyZElkKVxyXG4gICAgICAgICAgLnRoZW4oKG5ld0NhcmREYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXMobmV3Q2FyZERhdGEubGlrZXMpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gIH0pO1xyXG4gIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG59XHJcblxyXG5jb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAge1xyXG4gICAgaXRlbXM6IFtdLFxyXG4gICAgcmVuZGVyZXI6IChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xyXG4gICAgICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xyXG4gICAgfSxcclxuICB9LFxyXG4gIFwiLmNhcmRzX19saXN0XCJcclxuKTtcclxuXHJcbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XHJcbmRvY3VtZW50XHJcbiAgLnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybVZhbGlkYXRpb25PcHRpb25zLmZvcm1TZWxlY3RvcilcclxuICAuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IGZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtVmFsaWRhdGlvbk9wdGlvbnMsIGZvcm1FbGVtZW50KTtcclxuICAgIGZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaWRcIildID0gZm9ybVZhbGlkYXRvcjtcclxuICB9KTtcclxuXHJcbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcclxuICBuYW1lU2VsZWN0b3I6IFwiI3Byb2ZpbGUtdGl0bGVcIixcclxuICBqb2JTZWxlY3RvcjogXCIjcHJvZmlsZS1kZXNjXCIsXHJcbn0pO1xyXG5cclxuY29uc3QgcHJvZmlsZUVkaXRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxyXG4gIFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLFxyXG4gIChpbnB1dFZhbHVlcykgPT4ge1xyXG4gICAgYXBpXHJcbiAgICAgIC51cGRhdGVQcm9maWxlKHtcclxuICAgICAgICBuYW1lOiBpbnB1dFZhbHVlcy50aXRsZSxcclxuICAgICAgICBhYm91dDogaW5wdXRWYWx1ZXMuZGVzY3JpcHRpb24sXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgICAgam9iOiBkYXRhLmFib3V0LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHByb2ZpbGVFZGl0UG9wdXAuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIH0pO1xyXG4gIH0sXHJcbiAgZm9ybVZhbGlkYXRvcnNbXCJlZGl0LXByb2ZpbGUtZm9ybVwiXVxyXG4pO1xyXG5cclxuY29uc3QgYWRkQ2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjYWRkLWNhcmQtbW9kYWxcIixcclxuICAoaW5wdXRWYWx1ZXMpID0+IHtcclxuICAgIGNvbnN0IG5ld0NhcmREYXRhID0ge1xyXG4gICAgICBuYW1lOiBpbnB1dFZhbHVlcy50aXRsZSxcclxuICAgICAgbGluazogaW5wdXRWYWx1ZXMubGluayxcclxuICAgIH07XHJcbiAgICBhcGlcclxuICAgICAgLmFkZENhcmQobmV3Q2FyZERhdGEpXHJcbiAgICAgIC50aGVuKChjYXJkKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGNhcmQpO1xyXG4gICAgICAgIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICAgICAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICB9KTtcclxuICB9LFxyXG4gIGZvcm1WYWxpZGF0b3JzW1wiYWRkLWNhcmQtZm9ybVwiXVxyXG4pO1xyXG5cclxuY29uc3QgYXZhdGFyRWRpdFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjYXZhdGFyLWVkaXQtbW9kYWxcIixcclxuICAoaW5wdXRWYWx1ZXMpID0+IHtcclxuICAgIGFwaVxyXG4gICAgICAudXBkYXRlQXZhdGFyKGlucHV0VmFsdWVzLmF2YXRhcilcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICB1c2VySW5mby5zZXRBdmF0YXIoZGF0YS5hdmF0YXIpO1xyXG4gICAgICAgIGF2YXRhckVkaXRQb3B1cC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfSxcclxuICBmb3JtVmFsaWRhdG9yc1tcImVkaXQtYXZhdGFyLWZvcm1cIl1cclxuKTtcclxuXHJcbnByb2ZpbGVFZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuYWRkQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbmF2YXRhckVkaXRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgcG9wdXBXaXRoSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjbW9kYWwtaW1hZ2UtZGlzcGxheVwiKTtcclxucG9wdXBXaXRoSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZS1lZGl0LWJ1dHRvblwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IHVzZXJEYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByb2ZpbGUtdGl0bGUtaW5wdXRcIikudmFsdWUgPSB1c2VyRGF0YS5uYW1lO1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiKS52YWx1ZSA9IHVzZXJEYXRhLmpvYjtcclxuICBwcm9maWxlRWRpdFBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRDYXJkUG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgYXZhdGFyRWRpdFBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XHJcbiAgLy8gRmV0Y2ggdXNlciBpbmZvcm1hdGlvbiBhbmQgcmVuZGVyIGl0XHJcbiAgYXBpXHJcbiAgICAuZ2V0VXNlckluZm8oKVxyXG4gICAgLnRoZW4oKHVzZXJJbmZvRGF0YSkgPT4ge1xyXG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XHJcbiAgICAgICAgbmFtZTogdXNlckluZm9EYXRhLm5hbWUsXHJcbiAgICAgICAgam9iOiB1c2VySW5mb0RhdGEuYWJvdXQsXHJcbiAgICAgICAgYXZhdGFyOiB1c2VySW5mb0RhdGEuYXZhdGFyLFxyXG4gICAgICB9KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7IC8vIEhhbmRsZSBlcnJvcnMgYXBwcm9wcmlhdGVseVxyXG4gICAgfSk7XHJcblxyXG4gIC8vIEZldGNoIGluaXRpYWwgY2FyZHMgYW5kIHJlbmRlciB0aGVtXHJcbiAgYXBpXHJcbiAgICAuZ2V0SW5pdGlhbENhcmRzKClcclxuICAgIC50aGVuKChjYXJkcykgPT4ge1xyXG4gICAgICBjYXJkcy5mb3JFYWNoKChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XHJcbiAgICAgICAgc2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxuICAgICAgfSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnIpOyAvLyBIYW5kbGUgZXJyb3JzIGFwcHJvcHJpYXRlbHlcclxuICAgIH0pO1xyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICByZW5kZXJJdGVtcygpIHtcclxuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHRoaXMuX3JlbmRlcmVyKGl0ZW0pKTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICBqb2I6IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBqb2IgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudCA9IGpvYjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XHJcbiAgICB0aGlzLl9jYXB0aW9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtbGFiZWxcIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xyXG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gbmFtZTtcclxuICAgIHRoaXMuX2NhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJvcHRpb25zIiwidGhpcyIsIl9iYXNlVXJsIiwiYmFzZVVybCIsIl9oZWFkZXJzIiwiaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0SW5pdGlhbENhcmRzIiwidXBkYXRlUHJvZmlsZSIsImRhdGEiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm5hbWUiLCJhYm91dCIsInVwZGF0ZUF2YXRhciIsImF2YXRhciIsImFkZENhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwiZGlzbGlrZUNhcmQiLCJhdXRob3JpemF0aW9uIiwiQ2FyZCIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJfbmFtZSIsIl9saW5rIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9zZXRFdmVudExpc3RlbmVycyIsIl9jYXJkSW1hZ2VFbGVtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jYXJkRWxlbWVudCIsIl90b2dnbGVMaWtlQnV0dG9uIiwiX2RlbGV0ZUNhcmQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJyZW1vdmUiLCJnZW5lcmF0ZUNhcmQiLCJ0ZXh0Q29udGVudCIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJzZXR0aW5ncyIsImZvcm1FbGVtZW50IiwiX3NldHRpbmdzIiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvbiIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2hhc0ludmFsaWRJbnB1dCIsInNvbWUiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJhZGQiLCJkaXNhYmxlZCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJlcnJvckVsZW1lbnQiLCJpZCIsImlucHV0RXJyb3JDbGFzcyIsInZhbGlkYXRpb25NZXNzYWdlIiwiZXJyb3JDbGFzcyIsImZvckVhY2giLCJlbmFibGVWYWxpZGF0aW9uIiwicmVzZXRWYWxpZGF0aW9uIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwIiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsImZvcm1WYWxpZGF0b3IiLCJzdXBlciIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm0iLCJfZm9ybVZhbGlkYXRvciIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtVmFsdWVzIiwiaW5wdXQiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiLCJmb3JtVmFsaWRhdGlvbk9wdGlvbnMiLCJmb3JtU2VsZWN0b3IiLCJwb3B1cFdpdGhJbWFnZSIsImNyZWF0ZUNhcmQiLCJjYXJkRGF0YSIsImNhcmQiLCJoYW5kbGVEZWxldGVDYXJkIiwiYXBpIiwicmVtb3ZlQ2FyZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiaGFuZGxlTGlrZUNhcmQiLCJpc0xpa2VkIiwibmV3Q2FyZERhdGEiLCJ1cGRhdGVMaWtlcyIsImxpa2VzIiwic2VjdGlvbiIsIl9yZWYiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiY2FyZEVsZW1lbnQiLCJmb3JtVmFsaWRhdG9ycyIsImdldEF0dHJpYnV0ZSIsInVzZXJJbmZvIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsImpvYiIsInNldFVzZXJJbmZvIiwiX3JlZjIiLCJwcm9maWxlRWRpdFBvcHVwIiwiaW5wdXRWYWx1ZXMiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiYWRkQ2FyZFBvcHVwIiwiYXZhdGFyRWRpdFBvcHVwIiwic2V0QXZhdGFyIiwiX2ltYWdlIiwiX2NhcHRpb24iLCJnZXRFbGVtZW50QnlJZCIsInVzZXJEYXRhIiwidXNlckluZm9EYXRhIiwiY2FyZHMiXSwic291cmNlUm9vdCI6IiJ9